<% channel_name = generate_just_two_people_channel_name(user, current_user) %>
<% channel = channel_just_two_peoples.where(name: channel_name).first %>
<% channel_decorate = channel&.decorate %>

<%= turbo_frame_tag "user_#{user.id}" do %>
  <div class="flex justify-between items-center p-3 hover:bg-gray-800 rounded-lg relative sort-item"
       id="user-item-<%= user.id %>"
       data-controller='channels--latest-message'
       data-channels--latest-message-sender-id-value="<%= current_user.id %>"
       data-channels--latest-message-receiver-id-value="<%= user.id %>"
       data-channels--latest-message-channel-type-value="<%= Channel.types[:just_two_people] %>"
       data-channels--latest-message-channel-name-or-id-value="<%= channel_name %>"
       data-channels--index-target="userItem"
       data-action="click->channels--index#activeUser">
    <%= link_to "channel detail",
                show_or_create_channels_path(friend_id: user.id),
                class: 'hidden',
                id: "userItem#{user.id}",
                data: {
                  turbo_stream: '',
                  'channels--index-target': 'linkHidden'
                } %>
    <div class="w-16 h-16 relative flex flex-shrink-0">
      <%= image_tag user.avatar, class: 'shadow-md rounded-full w-full h-full object-cover', alt: "user_#{user.id}_avatar" %>
      <%= turbo_stream_from user, 'status' %>
      <%= render partial: 'users/status', locals: { user: user } %>
    </div>

    <div class="flex-auto min-w-0 ml-4 mr-6 hidden md:block group-hover:block">
      <p><%= user.name %></p>
      <% is_read = channel&.is_read_by?(current_user.id) %>

      <div class="flex items-center text-sm channel_user_last_message <%= is_read ? 'text-gray-600' : 'text-sm font-bold unread' %>"
           id="channel_<%= channel_name %>_user_last_message">
        <%= render partial: 'chat/sidebar/user/latest_message',
                   locals: {
                     channel: channel_decorate,
                   } %>
      </div>
    </div>
    <div class="channel_<%= channel_name %>_read_or_unread_latest_message channel_read_or_unread_latest_message">
      <% if channel.present? && !is_read %>
        <%= render partial: 'chat/sidebar/user/unread_latest_message' %>
      <% end %>
    </div>
  </div>
<% end %>
